SEP 019 -- Using SBOL to model the Design-Build-Test-Learn Cycle
======================================================


SEP                   | <leave empty>
----------------------|--------------
**Title**             | SEP 019 -- Using SBOL to model the Design-Build-Test-Learn Cycle
**Authors**           | Bryan Bartley (bartleyba@sbolstandard.org), Jake Beal (jakebeal@gmail.com), Raik Gruenberg (raik.gruenberg@gmail.com), James McLaughlin (j.a.mclaughlin@newcastle.ac.uk), Chris Myers (myers@ece.utah.edu), Nicholas Roehner (nicholasroehner@gmail.com), and Anil Wipat (anil.wipat@newcastle.ac.uk)
**Editor**            | Nicholas Roehner (nicholasroehner@gmail.com)
**Type**              | Data Model
**SBOL Version**      | 2.3
**Replaces**          | SEP 014, SEP 016, SEP 017, SEP 018
**Status**            | Draft
**Created**           | 10-Nov-2017
**Last modified**     | 10-Nov-2017

Abstract
-----------



Table of Contents
---------------------

* [1. Rationale](#rationale)
* [2. Specification](#specification)
  * [2.1 Implementation](#impl)
    * [2.1.1 Implementation.componentDefinitions](#compDef)
    * [2.1.2 Implementation.moduleDefinitions](#modDef)
  * [2.2 Attachment](#attach)
    * [2.2.1 Implementation.componentDefinitions](#source)
    * [2.2.2 Implementation.moduleDefinitions](#format)
    * [2.2.3 Implementation.componentDefinitions](#size)
    * [2.2.4 Implementation.moduleDefinitions](#hash)
  * [2.3 Design, Build, Test, and Learn](#dbtl)
  * [2.4 Best Practices](#best_practices)
  * [2.5 Validation Rules](#validation_rules)
* [3. Examples](#examples)
  * [3.1 iGEM Interlab](#igem)
  * [3.2 CRISPR Repression](#cripsr)
* [4. Backwards Compatibility](#compatibility)
* [5. Discussion](#discussion)
* [6. Relation to Other SEPs](#competing_seps)
* [References](#references)
* [Copyright](#copyright)

Rationale <a name="rationale"></a>
----------------

* Decouple the design-build-test-learn process, according to the foundational principles for engineering biology.
* Specify where to add experimental data
* Provide an SBOL representation of biological instances of a design that can link to LIMS systems
* Provide clear guidance for using PROV-O with illustrative examples. 
* Capture workflow provenance, a description of the events of a workflow, which is crucial for scientific reproducibility
* Support model-based design.

This SEP was initiated in response to the ["Design-Build-Test" thread] on sbol-dev.

Specification <a name="specification"></a>
----------------------------------------------

Here we define two new classes in the SBOL data model, `Implementation` and `Attachment`. We also define four new SBOL ontology terms (`sbol:design, sbol:build, sbol:test, and sbol:learn) to serve as  values for the `hadRole` properties of the PROV-O classes `Usage` and `Association`, which are required fields.

### 2.1 Implementation <a name="impl"></a>

![Implementation class UML diagram](images/sep_019_implementation.png "Implementation class UML diagram")

**Figure 1:** Diagram of the `Implementation` class and its associated properties

#### 2.1.1 Implementation.componentDefinitions <a name="compDef"></a>

TODO

#### 2.1.2 Implementation.moduleDefinitions <a name="modDef"></a>

TODO

### 2.2 Attachment <a name="attach"></a>

The `Attachment` class is a `TopLevel` object. The Attachment class has four properties:
“format” which is the format for the protocol, an EDAM protocol
* `source` - The source is a link to the external file and is REQUIRED.
* `format` - The format is an ontology term indicating the format of the file. It is RECOMMENDED to use the EDAM ontology for file formats, which includes a variety of experimental data formats. The `format` is a REQUIRED field
* `size` - The size is a long integer indicating the file size. This may be used by client applications accessing files over RESTful APIs. This field is OPTIONAL.
* `hash` - The hash is a string used to retrieve files from a cache. This field is OPTIONAL.

![attachment](images/sep_019_attachment.png "attachment")

**Figure 2:** Diagram of the `Attachment` class and its associated properties

### 2.3 Design, Build, Test, and Learn <a name="dbtl"></a>

The ontology terms `design`, `build`, `test`, and `learn` are defined here to indicate how objects are used in an `Activity` via the `hadRole` property on the `Usage` class. Additionally, these terms are also used to describe the roles that an `Agent` or `Plan`, such as a person, software tool, or protocol, may play in an `Activity` via the `hadRole` property on the `Association` class.

In natural language, these terms indicate the following:
* A "design" is a conceptual representation of an engineer's imagined and intended design
* A "build" is a real, physical instantiation of a conceptual design associated with a sample in the lab
* A "test" refers to raw data or observations gathered through experimental analysis
* To "learn" describes a process by which a theoretical model, analysis, datasheet, etc is derived from experimental data

### 2.4 Best Practices: Versioning versus Provenance Semantics <a name="best_practices"></a>

A new object which is the product of an `Activity` links back to the `Activity` which generated it via the `wasGeneratedBy` field. By the W3 PROV-O specification, generation is defined as:
```
...the completion of production of a new entity by an activity. This entity did not exist before generation and becomes available for usage after this generation.
```
Provenance semantics are somewhat different from the versioning semantics defined in the SBOL specification. The SBOL specification defines a new version of an object as an update of a previously published object (and therefore a previously existing object). In contrast, an SBOL object which is "generated" from another SHOULD BE regarded as a new entity, not a new version by the specification above. However, this distinction is somewhat subjective (see Theseus paradox).  Therefore we RECOMMEND as a best practice that objects linked by Activities not be successive versions of each other, though we leave this at the discretion of users and library developers.

### 2.5 Validation Rules <a name="validation_rules"></a>

The design-build-test-learn process generates new SBOL objects in the order of one or more `ModuleDefinitions`, followed by one or more `Implementations`, followed by one or more `Collections`, followed by one or more `Models`. This order of operations is enforced through the following validation rules:

* An `Activity` with a child Association of role "design" MUST generate a `ModuleDefinition` and MAY use a `Model` or other `ModuleDefinitions` as inputs via the `qualifiedUsage` property.
* An `Activity` with a child Association of role "build" MUST generate an `Implementation` and MAY  use a `ModuleDefinition` or other `Implementations` as inputs via the `qualifiedUsage` property.
* An `Activity` with a child Association of role "test" MUST generate a `Collection` of `Attachments` and MAY only use an `Implementation` or other `Collections` of `Attachments` as inputs via the `qualifiedUsage` property.
* An `Activity` with a child Association of role "learn" MUST generate a `Model` and MAY only use a `Collection` of `Attachments` or other `Models` as inputs via the `qualifiedUsage` property.

* A design Usage MUST refer to a ModuleDefinition
* A build Usage MUST refer to an Implementation
* A test Usage MUST refer to a Collection of Attachments
* A learn Usage MUST refer to a Model

Examples <a name='examples'></a>
-------------------------------

See [Discussion](#discussion) for an in-depth explanation of these examples.

### 3.1 Use Cases <a name="example1"></a>

![Use cases](images/sep_019_use_cases.png "Use cases")

### 3.2 Design-Build-Test-Learn Provenance <a name="example2"></a>

![Representing design-build-test-learn workflows with PROV-O](images/sep_019_provo.png "PROV-O")

### 3.3 Assembly Provenace <a name="example3"></a>

![Assembly provenance](images/sep_019_assembly_provenance.png "Assembly Provenance")

### 3.4 Implementation <a name="example4"></a>

TO DO

### 3.5 Attachment <a name="example5"></a>

![Attachment example](images/sep_019_attachment_example.png "Attachment example")

### 3.6 Derivation of Biological Replicates for iGEM Interlab Study <a name='igem'></a>

![Object UML diagram for iGEM interlab case study](images/sep_016_example_interlab.png "Object UML diagram for iGEM interlab case study")

### 3.7 Co-Transfection of Constructs for CRISPR Repression Module <a name='crispr'></a>

![Object UML diagram for CRISPR repression case study](images/sep_016_example_crispr.png "Object UML diagram for CRISPR repression case study")

Backwards Compatibility <a name='compatibility'></a>
-----------------

This proposal does not affect backwards compatibility.

Discussion <a name='discussion'></a>
-----------------

### 5.1 Design-build-test-learn

The design-build-test-learn cycle is a common theme in synthetic biology and engineering literature. The cycle is a generalized abstraction of an ideal engineering workflow and approach to problem-solving. Thefefore, the design-build-test-learn cycle is a de facto ontology upon which to base an SBOL data model for workflow abstraction. Other workflow activities in synthetic biology, such as analyzing, modeling, verifying, and evolving, by and large fit into the design-build-test-learn abstraction. 

This specification enables synthetic biologists to capture workflow provenance with SBOL. The aim is to
capture a complete description of evaluation and enactment of computational and laboratory protocols in a workflow. This is crucial to verification, reproducibility, and automation in synthetic biology. By specifying a coherent model for workflow provenance, we can also address other critical use cases such as specifying where to add experimental data and performing model-based design.

Provenance classes were previously adopted in SBOL 2.1, but a gap in the specification left some ambiguity in how these classes should be used.  The 2.1 specification indicates that the `hadRole` field on `Usage` and `Activity` classes MUST be provided, but does not define any terms to use in these fields. Because such terms are not specified, it is currently not possible for tool-builders to interpret or exchange provenance histories.

[Example 1](#example1) illustrates the various use cases that are possible with this provenance representation. Use case 1 describes linking many biological instances (plasmid clones, cellular clones, etc.) to the design which generated them. Use case 2 describes linking sequential stages of a build process which requires more than one processing step in the laboratory. Use case 3 describes a simple case of linking experimental data, such as sequencing data, to a sample. Use case 4 describes performing an experimental test on multiple samples at once in batch, for example in a 96-well plate.
Use case 5 describes a scenario in which different models (eg. deterministic vs stochastic) are derived from experimental data. Use case 6 describes a case in which data from multiple experiments are integrated into a single analysis. Use case 7 describes the creation of a model-based design. 

The Design, Build, and Test objects illustrated in Example 1 are included for purposes of discussion, but this specification does not actually introduce new classes by these names. Rather, this specification introduces the `Implementation` class to represent "Builds". Also this specification introduces `Attachments` in order to wrap experimental data files generated by a "Test". A "Design" is represented by a `ModuleDefinition`.

[Example 2](#example2) shows explicitly how SBOL objects can be linked via PROV-O in an idealized design-build-test-learn workflow. This particular example represents model-based design. The workflow begins with a Model which is used to generate a `ModuleDefinition` ("Design") using a computational tool such as iBioSim. This ModuleDefinition is then used to generate a new `Implementation` ("Build") via an AssemblyProtocol. Now that a "Build" has been constructed in the laboratory, a "Test" may be performed by running a MeasurementProtocol on laboratory equipment, thus generating a `Collection` of data files or `Attachments`. Finally, a new `Model` might be derived from these data. This `Model` may not match the beginning `Model`, as our observation may not match the prediction.

For illustrative purposes, Example 2A shows how `Agent` or `Plan` might be extended to represent the important players in a synthetic biology worflow.  For example, a ComputationalDesignProtocol may document that a Python script was executed in order to optimize a DNA sequence for synthesis. An AssemblyProtocol may describe a laboratory protocol (for example, either manual or automated). A SoftwareTool or Person are `Agents` that assist in an `Activity`. These examples illustrate where a developer might want to hook in their own application-specific data model. The PySBOL and libSBOL libraries allow users to define their own extension classes to `Plan` and `Agent` through inheritance relationships.

In addition to specifying a procedural workflow, this specification also allows us to interpret other kinds of provenance. [Example 3](#example3) illustrates an example of "assembly provenance".  This allows the user to track all of the physical instances of components which may be used in a DNA assembly procedure as well as the original design used to generate the new build. Other kinds of provenance are also possible. For example, provenance might also be used to track all the `Models` used to compose a more complicated `Model`.

### 5.2 Implementation

TODO

### 5.3 Attachment

[Example 5](#example5) illustrates how a "Test" may be represented as a `Collection` of `Attachments`. In this example, a quality control "Test" links a gel photo in PNG format and sequencing data in the AB1 format.

Relation to Other SEPs <a name='competing_seps'></a>
-----------------

This proposal evolved from SEP 14 after discussion at 2017 HARMONY and COMBINE workshops, on the Github issue tracker, and on the ["Design-Build-Test" thread]: https://groups.google.com/forum/#!topic/sbol-dev/AnpwJP2_f5A

References <a name='references'></a>
----------------

Copyright <a name='copyright'></a>
-------------
<p xmlns:dct="http://purl.org/dc/terms/" xmlns:vcard="http://www.w3.org/2001/vcard-rdf/3.0#">
  <a rel="license"
     href="http://creativecommons.org/publicdomain/zero/1.0/">
    <img src="http://i.creativecommons.org/p/zero/1.0/88x31.png" style="border-style: none;" alt="CC0" />
  </a>
  <br />
  To the extent possible under law,
  <a rel="dct:publisher"
     href="sbolstandard.org">
    <span property="dct:title">SBOL developers</span></a>
  has waived all copyright and related or neighboring rights to
  <span property="dct:title">SEP 007</span>.
This work is published from:
<span property="vcard:Country" datatype="dct:ISO3166"
      content="US" about="sbolstandard.org">
  United States</span>.
</p>
